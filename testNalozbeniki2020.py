funds_weekly = {
    'NLB Skladi - Svetovni razviti trgi delniški': -0.0994881316806342,
    'NLB Skladi - Slovenija mešani': 0.0469585527259317,
    'NLB Skladi - Dinamični razviti trgi delniški': -0.128595676255137,
    'NLB Skladi - Razvita Evropa delniški': -0.156723020251902,
    'NLB Skladi - Južna, srednja in vzhodna Evropa delniški': -0.128631254132687,
    'NLB Skladi - Farmacija in zdravstvo delniški': -0.0008215012629047,
    'NLB Skladi - Naravni viri delniški': -0.0900706969999093,
    'NLB Skladi - Visoka tehnologija delniški': -0.133660862654433,
    'NLB Skladi - Visoko rastoča gospodarstva delniški': -0.10352677140109,
    'NLB Skladi - Podjetniške obveznice EUR': -0.0128290622717602,
    'NLB Skladi - Globalni uravnoteženi': -0.0656662875142182,
    'NLB Skladi - Nova Evropa uravnoteženi': -0.0712273498170134,
    'NLB Skladi - Zahodni Balkan delniški': -0.0324227725299974,
    'NLB Skladi - Globalni delniški': -0.0978178235815405,
    'NLB Skladi - Azija delniški': -0.118303818754196,
    'NLB Skladi - Nepremičnine delniški': -0.0514936108995515,
    'NLB Skladi - Obveznice visokih donosnosti': -0.0032696347496104,
    'NLB Skladi - ZDA delniški': -0.0578783091210359,
    'NLB Skladi - Finance delniški': -0.1336,
    'NLB Skladi - Družbeno odgovorni razviti trgi delniški': -0.07262,
    'Obračunski sklad z zajamčenim donosom': 0.00999982014711964
}

funds_daily = {
    'NLB Skladi - Svetovni razviti trgi delniški': -0.0902471713188485,
    'NLB Skladi - Slovenija mešani': 0.0518266431588013,
    'NLB Skladi - Dinamični razviti trgi delniški': -0.132284773868774,
    'NLB Skladi - Razvita Evropa delniški': -0.146902625676211,
    'NLB Skladi - Južna, srednja in vzhodna Evropa delniški': -0.118812105812423,
    'NLB Skladi - Farmacija in zdravstvo delniški': 0.0141556239402121,
    'NLB Skladi - Naravni viri delniški': -0.0789374262101535,
    'NLB Skladi - Visoka tehnologija delniški': -0.0998850606935605,
    'NLB Skladi - Visoko rastoča gospodarstva delniški': -0.108262711864407,
    'NLB Skladi - Podjetniške obveznice EUR': -0.0107590108702561,
    'NLB Skladi - Globalni uravnoteženi': -0.0616267206836899,
    'NLB Skladi - Nova Evropa uravnoteženi': -0.060911089487152,
    'NLB Skladi - Zahodni Balkan delniški': -0.0238643634037108,
    'NLB Skladi - Globalni delniški': -0.0921278821647978,
    'NLB Skladi - Azija delniški': -0.0982721671577819,
    'NLB Skladi - Nepremičnine delniški': -0.0609924093337081,
    'NLB Skladi - Obveznice visokih donosnosti': -0.00898300191886414,
    'NLB Skladi - ZDA delniški': -0.0464425311641665,
    'NLB Skladi - Finance delniški': -0.15298,
    'NLB Skladi - Družbeno odgovorni razviti trgi delniški': -0.085,
    'Obračunski sklad z zajamčenim donosom': 0.00999982014711964,
}

funds_other = {
    'KBC Life Cash': -0.00646794150731134,
    'KBC Life Invest Fund Defensive, Class B': -0.066622812787791,
    'KBC Life Invest Fund Neutral, Class B': -0.0935082492551887,
    'KBC Life Invest Fund Dynamic, Class B': -0.113977249849003,
    'KBC Life Invest Fund Security NLB Vita Jumpstart 3': 0,
    'KBC Life Invest Fund Security NLB Vita Family Enterprises 1': 0,
    'KBC Life Invest Fund Security NLB Vita Jumpstart 4': 0,
    'KBC Life Invest Fund Security NLB Vita Asia 1': 0,
    'KBC Life Invest Fund Security NLB Vita Jumpstart 5': 0,
    'KBC Life Invest Fund Security NLB Vita Jumpstart 6': 0,
    'KBC EquiMax Jumpstart 900 H': 0,
    'KBC EquiMax Jumpstart 900 I': 0,
    'Investicijski paket NLB Vita Azija': -0.00620960468546228,
    'Investicijski paket NLB Vita Visoko rastoča gospodarstva': -0.00303473583040692,
    'Investicijski paket NLB Vita Dinamični delniški': -0.024705049750164,
    'Investicijski paket NLB Vita Dinamični delniški 2': -0.0261646245814023,
    'Investicijski paket NLB Vita Visoka tehnologija': -0.0230188047410227,
    'Investicijski paket NLB Vita Azija rast': -0.00569684769691092,
    'Investicijski paket NLB Vita Naravni viri': 0.00427483826026198,
    'Investicijski paket NLB Vita Svetovni razviti trgi': -0.00720153888602371,
    'Investicijski paket NLB Vita Visoko rastoča gospodarstva 2': -0.00359664201036425,
    'Investicijski paket NLB Vita Globalni': -0.00482418216532354,
    'Investicijski paket NLB Vita Razvita Evropa': -0.0178803056223327,
    'Obračunski sklad z zajamčenim donosom': 0.00999982014711964,
    'Investicijski paket NLB Vita Južna, srednja in vzhodna Evropa': -0.00732777402970342,
    'Investicijski paket NLB Vita Globalni delniški': -0.0046731323034952,
    'Investicijski paket NLB Vita Nepremičnine': 0.00193602664460113,
    'Investicijski paket NLB Vita Slovenija': 0.0296558975253911,
    'Investicijski paket NLB Vita Balkan': 0.000442722411988061,
    'Investicijski paket NLB Vita J, S in V Evropa 2': -0.0293722919461243,
    'Investicijski paket NLB Vita Visoko rastoča gospodarstva 3': -0.0275127712631555,
    'Investicijski paket NLB Vita Svetovni razviti trgi 2': -0.0200862838213753,
    'Investicijski paket NLB Vita Azija 2': -0.0240266981678097,
    'Investicijski paket NLB Vita Razvita Evropa 2': -0.0383622186689717,
    'Investicijski paket NLB Vita Dinamični delniški 3': -0.031359691508385,
    'Investicijski paket NLB Vita Južna, srednja in vzhodna Evropa 3': -0.0278392012691838,
    'Investicijski paket NLB Vita Globalni delniški 2': -0.0187176449688858,
    'Investicijski paket NLB Vita Razvita Evropa 3': -0.0307449572089731,
    'Investicijski paket NLB Vita Južna, srednja in vzhodna Evropa 4': -0.0252135576776233,
    'Investicijski paket NLB Vita Naravni viri 2': -0.0161355123325539,
    'Investicijski paket NLB Vita Azija 3': -0.010690831,
    'Investicijski paket NLB Vita Slovenija mešani': -0.00919449299999997,
    'Investicijski paket NLB Vita Zahodni Balkan 2': -0.00134679300000018,
    'Investicijski paket NLB Vita Družbeno odgovorni razviti trgi': -0.0112490040000002
}

products = {
    'NLB Naložba Vita Prva': 1,
    'NLB Naložba Vita Mega': 1,
    'NLB Vita Razigrana z naložbo v sklade': 1,
    'NLB Vita Izbrana': 2,
    'NLB Vita Varčevanje +': 2,
    'NLB Vita Privatno': 2,
    'NLB Naložba Vita Multi Senior': 3,
    'NLB Naložba Vita plus': 3,
    'NLB Naložba Vita Multi': 3
}

class Policy(object):
    def __init__(self,
                 c0,
                 corr_id,
                 e_cnt,
                 e_rn,
                 policy_no,
                 product_desc,
                 letter_id,
                 letter_date,
                 white_text1,
                 white_text2,
                 white_text3,
                 white_text4,
                 white_text5,
                 white_text6,
                 barcode,
                 name_and_surname,
                 name_and_surname_line2,
                 address,
                 post_no,
                 city,
                 country,
                 perno,
                 planno,
                 crncy,
                 data_date,
                 it_date,
                 vp,
                 vp_2018,
                 vp_2018_text,
                 pol_stat,
                 free_text1,
                 stipend_obroki,
                 text_stipendija,
                 text_soglasje,
                 marketing,
                 eposta,
                 eposta_naslov_za_posiljanje,
                 oseba_id,
                 barcode_soglasje,
                 ime_zavarovalec,
                 priimek_zavarovalec,
                 davcna_zavarovalec,
                 dob_zavarovalec,
                 pozdrav_stranki,
                 izpis_noge,
                 benefit_table,
                 benefits,
                 text_kapitalizacija,
                 text_poslovalnica,
                 fund_table_nalozba,
                 fund_table_zajamceni,
                 funds,
                 free_text2,
                 token,
                 povezava_soglasja,
                 pravna_oseba,
                 pol_ref_no,
                 sign_date,
                 skodni_14631,
                 skodni_13838,
                 investicijski_paket):
        self.c0 = c0
        self.corr_id = corr_id
        self.e_cnt = e_cnt
        self.e_rn = e_rn
        self.policy_no = policy_no
        self.product_desc = product_desc
        self.letter_id = letter_id
        self.letter_date = letter_date
        self.white_text1 = white_text1
        self.white_text2 = white_text2
        self.white_text3 = white_text3
        self.white_text4 = white_text4
        self.white_text5 = white_text5
        self.white_text6 = white_text6
        self.barcode = barcode
        self.name_and_surname = name_and_surname
        self.name_and_surname_line2 = name_and_surname_line2
        self.address = address
        self.post_no = post_no
        self.city = city
        self.country = country
        self.perno = perno
        self.planno = planno
        self.crncy = crncy
        self.data_date = data_date
        self.it_date = it_date
        self.vp = vp
        self.vp_2018 = vp_2018
        self.vp_2018_text = vp_2018_text
        self.pol_stat = pol_stat
        self.free_text1 = free_text1
        self.stipend_obroki = stipend_obroki
        self.text_stipendija = text_stipendija
        self.text_soglasje = text_soglasje
        self.marketing = marketing
        self.eposta = eposta
        self.eposta_naslov_za_posiljanje = eposta_naslov_za_posiljanje
        self.oseba_id = oseba_id
        self.barcode_soglasje = barcode_soglasje
        self.ime_zavarovalec = ime_zavarovalec
        self.priimek_zavarovalec = priimek_zavarovalec
        self.davcna_zavarovalec = davcna_zavarovalec
        self.dob_zavarovalec = dob_zavarovalec
        self.pozdrav_stranki = pozdrav_stranki
        self.izpis_noge = izpis_noge
        self.benefit_table = benefit_table
        self.benefits = benefits
        self.text_kapitalizacija = text_kapitalizacija
        self.text_poslovalnica = text_poslovalnica
        self.fund_table_nalozba = fund_table_nalozba
        self.fund_table_zajamceni = fund_table_zajamceni
        self.funds = funds
        self.free_text2 = free_text2
        self.token = token
        self.povezava_soglasja = povezava_soglasja
        self.pravna_oseba = pravna_oseba
        self.pol_ref_no = pol_ref_no
        self.sign_date = sign_date
        self.skodni_14631 = skodni_14631
        self.skodni_13838 = skodni_13838
        self.investicijski_paket = investicijski_paket
    def getC0(self): return self.c0
    def getCorr_id(self): return self.corr_id
    def getE_cnt(self): return self.e_cnt
    def getE_rn(self): return self.e_rn
    def getPolicy_no(self): return self.policy_no
    def getProduct_desc(self): return self.product_desc
    def getLetter_id(self): return self.letter_id
    def getLetter_date(self): return self.letter_date
    def getWhite_text1(self): return self.white_text1
    def getWhite_text2(self): return self.white_text2
    def getWhite_text3(self): return self.white_text3
    def getWhite_text4(self): return self.white_text4
    def getWhite_text5(self): return self.white_text5
    def getWhite_text6(self): return self.white_text6
    def getBarcode(self): return self.barcode
    def getName_and_surname(self): return self.name_and_surname
    def getName_and_surname_line2(self): return self.name_and_surname_line2
    def getAddress(self): return self.address
    def getPost_no(self): return self.post_no
    def getCity(self): return self.city
    def getCountry(self): return self.country
    def getPerno(self): return self.perno
    def getPlanno(self): return self.planno
    def getCrncy(self): return self.crncy
    def getData_date(self): return self.data_date
    def getIt_date(self): return self.it_date
    def getVp(self): return self.vp
    def getVp_2018(self): return self.vp_2018
    def getVp_2018_text(self): return self.vp_2018_text
    def getPol_stat(self): return self.pol_stat
    def getFree_text1(self): return self.free_text1
    def getStipend_obroki(self): return self.stipend_obroki
    def getText_stipendija(self): return self.text_stipendija
    def getText_soglasje(self): return self.text_soglasje
    def getMarketing(self): return self.marketing
    def getEposta(self): return self.eposta
    def getEposta_naslov_za_posiljanje(self): return self.eposta_naslov_za_posiljanje
    def getOseba_id(self): return self.oseba_id
    def getBarcode_soglasje(self): return self.barcode_soglasje
    def getIme_zavarovalec(self): return self.ime_zavarovalec
    def getPriimek_zavarovalec(self): return self.priimek_zavarovalec
    def getDavcna_zavarovalec(self): return self.davcna_zavarovalec
    def getDob_zavarovalec(self): return self.dob_zavarovalec
    def getPozdrav_stranki(self): return self.pozdrav_stranki
    def getIzpis_noge(self): return self.izpis_noge
    def getBenefit_table(self): return self.benefit_table
    def getBenefits(self): return self.benefits
    def getText_kapitalizacija(self): return self.text_kapitalizacija
    def getText_poslovalnica(self): return self.text_poslovalnica
    def getFund_table_nalozba(self): return self.fund_table_nalozba
    def getFund_table_zajamceni(self): return self.fund_table_zajamceni
    def getFunds(self): return self.funds
    def getFree_text2(self): return self.free_text2
    def getToken(self): return self.token
    def getPovezava_soglasja(self): return self.povezava_soglasja
    def getPravna_oseba(self): return self.pravna_oseba
    def getPol_ref_no(self): return self.pol_ref_no
    def getSign_date(self): return self.sign_date
    def getSkodni_14631(self): return self.skodni_14631
    def getSkodni_13838(self): return self.skodni_13838
    def getInvesticijski_paket(self): return self.investicijski_paket
    def __repr__(self): return f"c0: {self.c0}\ncorr_id: {self.corr_id}\ne_cnt: {self.e_cnt}\ne_rn: {self.e_rn}\npolicy_no: {self.policy_no}\nproduct_desc: {self.product_desc}\nletter_id: {self.letter_id}\nletter_date: {self.letter_date}\nwhite_text1: {self.white_text1}\nwhite_text2: {self.white_text2}\nwhite_text3: {self.white_text3}\nwhite_text4: {self.white_text4}\nwhite_text5: {self.white_text5}\nwhite_text6: {self.white_text6}\nbarcode: {self.barcode}\nname_and_surname: {self.name_and_surname}\nname_and_surname_line2: {self.name_and_surname_line2}\naddress: {self.address}\npost_no: {self.post_no}\ncity: {self.city}\ncountry: {self.country}\nperno: {self.perno}\nplanno: {self.planno}\ncrncy: {self.crncy}\ndata_date: {self.data_date}\nit_date: {self.it_date}\nvp: {self.vp}\nvp_2018: {self.vp_2018}\nvp_2018_text: {self.vp_2018_text}\npol_stat: {self.pol_stat}\nfree_text1: {self.free_text1}\nstipend_obroki: {self.stipend_obroki}\ntext_stipendija: {self.text_stipendija}\ntext_soglasje: {self.text_soglasje}\nmarketing: {self.marketing}\neposta: {self.eposta}\neposta_naslov_za_posiljanje: {self.eposta_naslov_za_posiljanje}\noseba_id: {self.oseba_id}\nbarcode_soglasje: {self.barcode_soglasje}\nime_zavarovalec: {self.ime_zavarovalec}\npriimek_zavarovalec: {self.priimek_zavarovalec}\ndavcna_zavarovalec: {self.davcna_zavarovalec}\ndob_zavarovalec: {self.dob_zavarovalec}\npozdrav_stranki: {self.pozdrav_stranki}\nizpis_noge: {self.izpis_noge}\nbenefit_table: {self.benefit_table}\nbenefits: {self.benefits}\ntext_kapitalizacija: {self.text_kapitalizacija}\ntext_poslovalnica: {self.text_poslovalnica}\nfund_table_nalozba: {self.fund_table_nalozba}\nfund_table_zajamceni: {self.fund_table_zajamceni}\nfunds: {self.funds}\nfree_text2: {self.free_text2}\ntoken: {self.token}\npovezava_soglasja: {self.povezava_soglasja}\npravna_oseba: {self.pravna_oseba}\npol_ref_no: {self.pol_ref_no}\nsign_date: {self.sign_date}\nskodni_14631: {self.skodni_14631}\nskodni_13838: {self.skodni_13838}\ninvesticijski_paket: {self.investicijski_paket}"

class Benefit(object):
    def __init__(self,
                 benfno,
                 benefit_desc,
                 sum_assured):
        self.benfno = benfno,
        self.benefit_desc = benefit_desc
        self.sum_assured = sum_assured
    def getBenfno(self): return self.benfno
    def getBenefit_desc(self): return self.benefit_desc
    def getSum_assured(self): return self.sum_assured
    def __repr__(self): return f"benfno: {self.benfno}\nbenefit_desc: {self.benefit_desc}\nsum_assured: {self.sum_assured}"

class Fund(object):
    def __init__(self,
                 fundno,
                 fund_desc,
                 fund_bonus):
        self.fundno = fundno
        self.fund_desc = fund_desc
        self.fund_bonus = fund_bonus
    def getFundno(self): return self.fundno
    def getFund_desc(self): return self.fund_desc
    def getFund_bonus(self): return self.fund_bonus
    def getFund_bonus_percentage(self): return round(self.fund_bonus * 100, 2)
    def __repr__(self): return f"fundno: {self.fundno}\nfund_desc: {self.fund_desc}\nfund_bonus: {self.fund_bonus}"

def binarySearch(iterable, item):
    """
    Performs a binary search on a sorted iterable.
    !!! Requires a sorted iterable. !!!
    :param iterable: iterable to search
    :param item: item to search for
    :return: if item found: index of item position; if item not found: False
    """
    low = 0
    high = len(iterable)
    while high > low:
        mid = (low + high) // 2
        if iterable[mid] == item: return mid
        elif iterable[mid] < item: low = mid + 1
        else: high = mid
    return False

def verifyDate(date_string):
    """
    Verifies input date in D.M.YYYY format.
    :param date_string: str; string of date in D.M.YYYY format
    :return: True if valid date, False otherwise
    """
    if len(date_string) < 8 or len(date_string) > 10: return False
    for i in range(len(date_string)):
        if date_string[1] == ".":
            if int(date_string[0]) <= 0: return False
            if date_string[3] == ".":
                if int(date_string[2]) <= 0: return False
                if int(date_string[4:]) <= 999: return False
            else:
                if int(date_string[2:4]) <= 0 or int(date_string[2:4]) > 12: return False
                if int(date_string[5:]) <= 999: return False
        else:
            if int(date_string[:2]) <= 0 or int(date_string[:2]) > 31: return False
            if date_string[4] == ".":
                if int(date_string[3]) <= 0: return False
                if int(date_string[5:]) <= 999: return False
            else:
                if int(date_string[3:5]) <= 0 or int(date_string[3:5]) > 12: return False
                if int(date_string[6:]) <= 999: return False
    return True

def convertDateYYYYMMDD(date):
    """
    Converts date from D.M.YYYY format to YYYY-MM-DD format.
    :param date: str; date in D.M.YYYY format
    :return: str; converted date in YYYY-MM-DD format
    """
    assert verifyDate(date)
    (day, month, year) = date.split(".")
    return "{}{}{}".format(year, month if len(month) > 1 else "0" + month, day if len(day) > 1 else "0" + day)

def getDataXML(file, Policy):
    from bs4 import BeautifulSoup as bs
    soup = bs(open(file), "lxml")
    rows = soup.find_all("row")
    policies = list()
    for row in rows:
        c0 = int(row.find("c0").getText())
        corr_id = int(row.find("corr_id").getText())
        e_cnt = int(row.find("e_cnt").getText())
        e_rn = int(row.find("e_rn").getText())
        policy_no = row.find("policy_no").getText()
        product_desc = row.find("product_desc").getText()
        letter_id = int(row.find("letter_id").getText())
        letter_date = row.find("letter_date").getText()
        white_text1 = row.find("white_text1").getText()
        white_text2 = row.find("white_text2").getText()
        white_text3 = row.find("white_text3").getText()
        white_text4 = row.find("white_text4").getText()
        white_text5 = row.find("white_text5").getText()
        white_text6 = row.find("white_text6").getText()
        barcode = row.find("barcode").getText()
        name_and_surname = row.find("name_and_surname").getText()
        name_and_surname_line2 = row.find("name_and_surname_line2").getText()
        address = row.find("address").getText()
        post_no = row.find("post_no").getText()
        city = row.find("city").getText()
        country = row.find("country").getText()
        perno = int(row.find("perno").getText())
        planno = int(row.find("planno").getText())
        crncy = row.find("crncy").getText()
        data_date = row.find("data_date").getText()
        it_date = row.find("it_date").getText()
        try: vp = float(row.find("vp").getText().replace(".", "").replace(",", "."))
        except ValueError: vp = None
        vp_2018 = float(row.find("vp_2018").getText().replace(".", "").replace(",", ".")) if row.find("vp_2018").getText() else ""
        vp_2018_text = row.find("vp_2018_text").getText()
        pol_stat = row.find("pol_stat").getText()
        free_text1 = row.find("free_text1").getText()
        stipend_obroki = row.find("stipend_obroki").getText()
        text_stipendija = row.find("text_stipendija").getText()
        text_soglasje = row.find("text_soglasje").getText()
        marketing = True if row.find("marketing").getText() == "DA" else False
        eposta = True if row.find("eposta").getText() == "DA" else False
        eposta_naslov_za_posiljanje = row.find("eposta_naslov_za_posiljanje").getText()
        oseba_id = int(row.find("oseba_id").getText())
        barcode_soglasje = row.find("barcode_soglasje").getText()
        ime_zavarovalec = row.find("ime_zavarovalec").getText()
        priimek_zavarovalec = row.find("priimek_zavarovalec").getText()
        davcna_zavarovalec = int(row.find("davcna_zavarovalec").getText())
        dob_zavarovalec = row.find("dob_zavarovalec").getText()
        pozdrav_stranki = row.find("pozdrav_stranki").getText()
        izpis_noge = row.find("izpis_noge").getText()
        benefit_table = True if row.find("benefit_table").getText() == "DA" else False
        benefits = list()
        for benefit in row.find("benefits"): benefits.append(Benefit(benefit.find("benefit_desc").getText(), float(benefit.find("sum_assured").getText().replace(".", "").replace(",", ".")), int(benefit.find("pol_ref_no").getText())))
        text_kapitalizacija = row.find("text_kapitalizacija").getText()
        text_poslovalnica = row.find("text_poslovalnica").getText()
        fund_table_nalozba = True if row.find("fund_table_nalozba").getText() == "DA" else False
        fund_table_zajamceni = True if row.find("fund_table_zajamceni").getText() == "DA" else False
        funds = list()
        for fund in row.find("funds"):funds.append(Fund(fund.find("fund_desc").getText(), float(fund.find("fund_bonus").getText()[:-2].replace(",", ".")) / 100))
        free_text2 = row.find("free_text2").getText()
        token = row.find("token").getText()
        povezava_soglasja = row.find("povezava_soglasja").getText()
        pravna_oseba = True if row.find("pravna_oseba").getText() == "DA" else False
        policies.append(Policy(c0,
                               corr_id,
                               e_cnt,
                               e_rn,
                               policy_no,
                               product_desc,
                               letter_id,
                               letter_date,
                               white_text1,
                               white_text2,
                               white_text3,
                               white_text4,
                               white_text5,
                               white_text6,
                               barcode,
                               name_and_surname,
                               name_and_surname_line2,
                               address,
                               post_no,
                               city,
                               country,
                               perno,
                               planno,
                               crncy,
                               data_date,
                               it_date,
                               vp,
                               vp_2018,
                               vp_2018_text,
                               pol_stat,
                               free_text1,
                               stipend_obroki,
                               text_stipendija,
                               text_soglasje,
                               marketing,
                               eposta,
                               eposta_naslov_za_posiljanje,
                               oseba_id,
                               barcode_soglasje,
                               ime_zavarovalec,
                               priimek_zavarovalec,
                               davcna_zavarovalec,
                               dob_zavarovalec,
                               pozdrav_stranki,
                               izpis_noge,
                               benefit_table,
                               tuple(benefits),
                               text_kapitalizacija,
                               text_poslovalnica,
                               fund_table_nalozba,
                               fund_table_zajamceni,
                               tuple(funds),
                               free_text2,
                               token,
                               povezava_soglasja,
                               pravna_oseba))
    return tuple(policies)

def getDataXLSX(file_nalozbeniki, file_fund, file_benefit, Policy, Fund, Benefit):
    from openpyxl import load_workbook
    wb_n = load_workbook(file_nalozbeniki, read_only=True)
    wb_f = load_workbook(file_fund, read_only=True)
    wb_b = load_workbook(file_benefit, read_only=True)
    sheet_n = wb_n["SQL Results"]
    sheet_f = wb_f["SQL Results"]
    sheet_b = wb_b["SQL Results"]
    policies = list()
    rows_n = sheet_n.rows
    for row in rows_n:
        print(row)
    for i in range(1, len(sheet_n["A"])):
        print(sheet_n["E"][i].value)
        if sheet_n["A"][i].value:
            c0 = int(sheet_n["A"][i].value)
            corr_id = int(sheet_n["B"][i].value)
            e_cnt = int(sheet_n["C"][i].value)
            e_rn = int(sheet_n["D"][i].value)
            policy_no = int(sheet_n["E"][i].value)
            product_desc = sheet_n["F"][i].value
            letter_id = int(sheet_n["G"][i].value)
            letter_date = sheet_n["H"][i].value
            white_text1 = sheet_n["I"][i].value
            white_text2 = sheet_n["J"][i].value
            white_text3 = sheet_n["K"][i].value
            white_text4 = sheet_n["L"][i].value
            white_text5 = sheet_n["M"][i].value
            white_text6 = sheet_n["N"][i].value
            barcode = sheet_n["O"][i].value
            name_and_surname = sheet_n["P"][i].value
            name_and_surname_line2 = sheet_n["Q"][i].value
            address = sheet_n["R"][i].value
            post_no = sheet_n["S"][i].value
            city = sheet_n["T"][i].value
            country = sheet_n["U"][i].value
            perno = int(sheet_n["V"][i].value)
            planno = int(sheet_n["W"][i].value)
            crncy = sheet_n["X"][i].value
            data_date = sheet_n["Y"][i].value
            it_date = sheet_n["Z"][i].value
            try: vp = float(sheet_n["AA"][i].value.replace(".", "").replace(",", "."))
            except ValueError: vp = None
            vp_2019 = float(sheet_n["AB"][i].value.replace(".", "").replace(",", ".")) if sheet_n["AB"][i].value else ""
            vp_2019_text = sheet_n["AC"][i].value
            pol_stat = sheet_n["AD"][i].value
            free_text1 = sheet_n["AE"][i].value
            stipend_obroki = sheet_n["AF"][i].value
            text_stipendija = sheet_n["AG"][i].value
            text_soglasje = sheet_n["AH"][i].value
            marketing = True if sheet_n["AI"][i].value in ("DA", 1) else False
            eposta = True if sheet_n["AJ"][i].value in ("DA", 1) else False
            eposta_naslov_za_posiljanje = sheet_n["AK"][i].value
            oseba_id = int(sheet_n["AL"][i].value)
            barcode_soglasje = sheet_n["AM"][i].value
            ime_zavarovalec = sheet_n["AN"][i].value
            priimek_zavarovalec = sheet_n["AO"][i].value
            davcna_zavarovalec = int(sheet_n["AP"][i].value)
            dob_zavarovalec = sheet_n["AQ"][i].value
            pozdrav_stranki = sheet_n["AR"][i].value
            izpis_noge = sheet_n["AS"][i].value
            benefit_table = True if sheet_n["AT"][i].value in ("DA", 1) else False
            text_kapitalizacija = sheet_n["AU"][i].value
            text_poslovalnica = sheet_n["AV"][i].value
            fund_table_nalozba = True if sheet_n["AW"][i].value in ("DA", 1) else False
            fund_table_zajamceni = True if sheet_n["AX"][i].value in ("DA", 1) else False
            free_text2 = sheet_n["AY"][i].value
            token = sheet_n["AZ"][i].value
            povezava_soglasja = sheet_n["BA"][i].value
            pravna_oseba = True if sheet_n["BB"][i].value in ("DA", 1) else False
            pol_ref_no = int(sheet_n["BC"][i].value)
            sign_date = sheet_n["BD"][i].value
            skodni_14631 = True if sheet_n["BE"][i].value in ("DA", 1) else False
            skodni_13838 = True if sheet_n["BF"][i].value in ("DA", 1) else False
            investicijski_paket = sheet_n["BG"][i].value.split(", ") if sheet_n["BG"][i].value else None
            benefits = list()
            benf_pol_ref_nos = [int(v.value) for v in sheet_b["B"][1:]]
            benf_pos_found = binarySearch(benf_pol_ref_nos, pol_ref_no) + 1
            benf_pos_first = benf_pos_found
            if benf_pos_first > 1:
                while True: # finds first occurring position of pol_ref_no
                    if int(sheet_b["B"][benf_pos_first - 1].value) == pol_ref_no:
                        benf_pos_first -= 1
                    else: break
            while True: # fetches all benefits for pol_ref_no
                if int(sheet_b["B"][benf_pos_first].value) == pol_ref_no:
                    benefits.append(Benefit(int(sheet_b["E"][benf_pos_first].value),
                                            sheet_b["C"][benf_pos_first].value,
                                            float(sheet_b["D"][benf_pos_first].value)))
                    benf_pos_first += 1
                else: break
            funds = list()
            fund_pol_ref_nos = [int(v.value) for v in sheet_f["B"][1:]]
            fund_pos_found = binarySearch(fund_pol_ref_nos, pol_ref_no) + 1
            fund_pos_first = fund_pos_found
            if fund_pos_first > 1:
                while True: # finds first occurring position of pol_ref_no
                    if int(sheet_f["B"][fund_pos_first - 1].value) == pol_ref_no:
                        fund_pos_first -= 1
                    else: break
            while True: # fetches all funds for pol_ref_no
                if int(sheet_f["B"][fund_pos_first].value) == pol_ref_no:
                    funds.append(Fund(int(sheet_f["E"][fund_pos_first].value),
                                      sheet_f["C"][fund_pos_first].value,
                                      float(sheet_b["D"][fund_pos_first].value)))
                    fund_pos_first += 1
                else: break
            policies.append(Policy(c0,
                                   corr_id,
                                   e_cnt,
                                   e_rn,
                                   policy_no,
                                   product_desc,
                                   letter_id,
                                   letter_date,
                                   white_text1,
                                   white_text2,
                                   white_text3,
                                   white_text4,
                                   white_text5,
                                   white_text6,
                                   barcode,
                                   name_and_surname,
                                   name_and_surname_line2,
                                   address,
                                   post_no,
                                   city,
                                   country,
                                   perno,
                                   planno,
                                   crncy,
                                   data_date,
                                   it_date,
                                   vp,
                                   vp_2019,
                                   vp_2019_text,
                                   pol_stat,
                                   free_text1,
                                   stipend_obroki,
                                   text_stipendija,
                                   text_soglasje,
                                   marketing,
                                   eposta,
                                   eposta_naslov_za_posiljanje,
                                   oseba_id,
                                   barcode_soglasje,
                                   ime_zavarovalec,
                                   priimek_zavarovalec,
                                   davcna_zavarovalec,
                                   dob_zavarovalec,
                                   pozdrav_stranki,
                                   izpis_noge,
                                   benefit_table,
                                   benefits,
                                   text_kapitalizacija,
                                   text_poslovalnica,
                                   fund_table_nalozba,
                                   fund_table_zajamceni,
                                   funds,
                                   free_text2,
                                   token,
                                   povezava_soglasja,
                                   pravna_oseba,
                                   pol_ref_no,
                                   sign_date,
                                   skodni_14631,
                                   skodni_13838,
                                   investicijski_paket))

def verifyLetter_id(policy_no, letter_id, code, type, year):
    if letter_id == int("{}{}{}{}".format(code, type, policy_no, year)): return True
    else: return False

def verifyLetter_date(letter_date, dos):
    if letter_date == dos: return True
    else: return False

def verifyWhite_text1(white_text1, policy_no):
    if white_text1 == "$policy_no${}".format(policy_no): return True
    else: return False

def verifyWhite_text2(white_text2, letter_id):
    if white_text2 == "$letter_id${}".format(letter_id): return True
    else: return False

def verifyWhite_text3(white_text3, letter_date):
    if white_text3 == "$letter_date${}".format(letter_date): return True
    else: return False

def verifyWhite_text4(white_text4, letter_type):
    if white_text4 == "$letter_type${}".format(letter_type): return True
    else: return False

def verifyWhite_text5(white_text5, letter_desc):
    if white_text5 == "$letter_desc${}".format(letter_desc): return True
    else: return False

def verifyWhite_text6(white_text6, product_desc):
    if white_text6 == "$product_desc${}".format(product_desc): return True
    else: return False

def verifyBarcode(barcode, policy_no, type, version):
    if barcode == "{}!{}#{}".format(type, policy_no, version): return True
    else: return False

def verifyVP(vp):
    if vp: return True
    else: return False

def verifyFree_text1(free_text1, planno, yob, yobs):
    if planno in (1115, 1117, 1215, 133, 138) and yob in yobs and free_text1: return True
    elif not (planno in (1115, 1117, 1215, 133, 138) and yob in yobs) and not free_text1: return True
    else: return False

def verifyCountry(country, post_no):
    from re import search
    if len(post_no) == 4 and post_no.isdigit():
        if not search(r"\w+", country): return True
        else: return False
    else:
        if search(r"\w+", country): return True
        else: return False

def verifyData_date(data_date, previous_year):
    if data_date == "31. 12. {}".format(previous_year): return True
    else: return False

def verifyVp_2018_text(vp_2018_text, vp_2018):
    if vp_2018 and vp_2018_text: return True
    elif not vp_2018 and not vp_2018_text: return True
    else: return False

def verifyStipend_obroki(stipend_obroki, pol_stat):
    if pol_stat in ("Y") and stipend_obroki: return True
    elif pol_stat not in ("Y") and not stipend_obroki: return True
    else: return False

def verifyText_stipendija(text_stipendija, stipend_obroki, pol_stat):
    if pol_stat in ("Y") and text_stipendija == "Število preostalih obrokov za izplačilo štipendije na dan 31. 12. 2018 je bilo {}.".format(stipend_obroki): return True
    elif pol_stat not in ("Y") and not text_stipendija: return True
    else: return False

def verifyText_soglasje(text_soglasje, pravna_oseba):
    if not pravna_oseba:
        if text_soglasje == "NLB Vita je okolju prijazna zavarovalnica. Pri tem nam lahko s podpisom priloženega soglasja za obveščanje po elektronski pošti pomagate tudi vi, tako da nam ga pošljete nazaj na naš naslov. Tako boste v prihodnje tovrstna obvestila prejemali izključno po elektronski pošti.": return True
        else: return False
    else:
        if not text_soglasje: return True
        else: return False

def verifyEposta_naslov_za_posiljanje(eposta_naslov_za_posiljanje):
    from re import search
    if bool(search(r"^[a-zA-Z0-9_\-.]+@[a-zA-Z0-9_\-.]+$", eposta_naslov_za_posiljanje)): return True
    else: return False

def verifyBarcode_soglasje(barcode_soglasje, oseba_id, eposta, pravna_oseba, pre, post):
    if not eposta and not pravna_oseba and barcode_soglasje == "{}!{}#{}".format(pre, oseba_id, post): return True
    elif not (not eposta and not pravna_oseba) and not barcode_soglasje: return True
    else: return False

def verifyDavcna_zavarovalec(davcna_zavarovalec):
    vat_check     = davcna_zavarovalec % 10
    vat_remainder = davcna_zavarovalec // 10
    vat_sum       = 0
    for i in range(2, 9):
        vat_sum += (vat_remainder % 10) * i
        vat_remainder //= 10
    vat_checksum = 11 - (vat_sum % 11)
    if vat_checksum in (10, 11): vat_checksum = 0
    if vat_check == vat_checksum: return True
    else: return False

def verifyPozdrav_stranki(pozdrav_stranki, pravna_oseba, ime_zavarovalec, priimek_zavarovalec):
    if pravna_oseba:
        if pozdrav_stranki == "Spoštovani,": return True
        else: return False
    else:
        if "gosp" in pozdrav_stranki and "{} {},".format(ime_zavarovalec.lower(), priimek_zavarovalec.lower()) in pozdrav_stranki.lower(): return True
        else: return False

def verifyIzpis_noge(izpis_noge, marketing):
    if marketing:
        if len(izpis_noge) == 609: return True
        else: return False
    else:
        if len(izpis_noge) == 204: return True
        else: return False

def verifyBenefit_table(benefit_table, pol_stat):
    if pol_stat not in ("Y", "T", "U", "B") and benefit_table: return True
    elif pol_stat in ("Y", "T", "U", "B") and not benefit_table: return True
    else: return False

def verifyBenefits(benefit_table, benefits):
    if benefit_table and benefits: return True
    elif not benefit_table and not benefits: return True
    else: return False

def verifyBenefit_desc(benefit_desc):
    if benefit_desc in ("Zavarovalna vsota za smrt",
                        "Zavarovalna vsota za dodatno nezgodno zavarovanje",
                        "Zavarovalna vsota za zavarovanje nezgodne smrti in nezgodne popolne trajne invalidnosti",
                        "Zavarovalna vsota za dodatno zavarovanje nezgodne smrti",
                        "Zavarovalna vsota za dodatno nezgodno zavarovanje popolne trajne invalidnosti",
                        "Zavarovalna vsota za nezgodno zavarovanje upravičenca",
                        "Zavarovalna vsota za dodatno življenjsko zavarovanje",
                        "Zavarovalna vsota za dodatno zavarovanje kritičnih bolezni"):
        return True
    else: return False

def verifyText_kapitalizacija(text_kapitalizacija, pol_stat):
    if pol_stat == "U":
        if text_kapitalizacija == "Vaše zavarovanje je kapitalizirano, zato je zavarovalna vsota za osnovno kritje enaka vrednosti police.": return True
        else: return False
    else:
        if not text_kapitalizacija: return True
        else: return False

def verifyText_poslovalnica(text_poslovalnica, pravna_oseba):
    if not pravna_oseba:
        if text_poslovalnica == "Vaša zavarovanja si lahko kadarkoli pogledate v spletni poslovalnici e-NLB Vita, do katere lahko dostopate na spletnem portalu www.nlbvita.si. Po nekaj enostavnih korakih registracije lahko kadarkoli in kjerkoli pridobite informacije o vrednosti vaših zavarovanj, vrednosti točke košarice skladov, zavarovalnih kritjih in zavarovalnih vsotah, plačanih in zapadlih premijah, upravičencih itd. V spletni poslovalnici so vidna tudi vsa obvestila NLB Vite.": return True
        else: return False
    else:
        if not text_poslovalnica: return True
        else: return False

def verifyFund_table_nalozba(fund_table_nalozba, planno):
    if fund_table_nalozba:
        if planno not in (132, 1321, 137, 1371): return True
        else: return False
    else:
        if planno in (132, 1321, 137, 1371): return True
        else: return False

def verifyFund_table_zajamceni(fund_table_zajamceni, planno):
    if fund_table_zajamceni:
        if planno in (132, 1321, 137, 1371, 130, 1301, 135, 1351): return True
        else: return False
    else:
        if planno not in (132, 1321, 137, 1371, 130, 1301, 135, 1351): return True
        else: return False

def verifyFunds(fund_table_nalozba, fund_table_zajamceni, funds):
    if fund_table_nalozba and funds: return True
    elif not (fund_table_nalozba or fund_table_zajamceni) and not funds: return True
    elif (fund_table_zajamceni and not fund_table_nalozba) and not funds: return True
    else: return False

def verifyFund_bonus(product_desc, funds, policy_no):
    counter = 0
    try:
        if products[product_desc] == 1:
            for fund in funds:
                if round(fund.getFund_bonus(), 2) != round(funds_weekly[fund.getFund_desc()], 2):
                    print(policy_no, fund.getFund_desc(), round(fund.getFund_bonus(), 2), round(funds_weekly[fund.getFund_desc()], 2))
                    counter += 1
        elif products[product_desc] == 2:
            for fund in funds:
                if round(fund.getFund_bonus(), 2) != round(funds_daily[fund.getFund_desc()], 2):
                    print(policy_no, fund.getFund_desc(), round(fund.getFund_bonus(), 2), round(funds_daily[fund.getFund_desc()], 2))
                    counter += 1
        else:
            for fund in funds:
                if round(fund.getFund_bonus(), 2) != round(funds_other[fund.getFund_desc()], 2):
                    print(policy_no, fund.getFund_desc(), round(fund.getFund_bonus(), 2), round(funds_other[fund.getFund_desc()], 2))
                    counter += 1
    except KeyError:
        print(datum.getPolicy_no(), product_desc, fund.getFund_desc(), "product {}".format(products[product_desc]))
        counter += 1
    if counter: return False
    else: return True

def verifyFree_text2(free_text2, funds):
    if not funds and not free_text2: return True
    elif len(funds) == 1 and free_text2 == "Vaše naložbeno premoženje je na dan 31. 12. 2018 sestavljal spodaj prikazani podsklad:": return True
    elif len(funds) == 2 and free_text2 == "Vaše naložbeno premoženje sta na dan 31. 12. 2018 sestavljala spodaj prikazana podsklada:": return True
    elif len(funds) >= 3 and free_text2 == "Vaše naložbeno premoženje so na dan 31. 12. 2018 sestavljali spodaj prikazani podskladi:": return True
    else: return False

def decodeToken(token, salt, dob, taxno, dos):
    from hashlib import md5
    try: assert len(token) == 32
    except AssertionError:
        return "Token length not 32."
    crkeStevilke = {"e": "0", "f": "1", "g": "2", "h": "3", "i": "4", "j": "5", "k": "6", "l": "7", "m": "8", "n": "9"}
    DS = token[:2] + token[6:8] + token[12:14] + token[18:20]
    rojstniDatum = token[2:4] + token[8:10] + token[14:16] + token[20:22]
    datumPosiljanjaPlus1M = token[24:]
    if datumPosiljanjaPlus1M != dos: return -1
    checksum = token[4:6] + token[10:12] + token[16:18] + token[22:24]
    if md5(bytes(DS + rojstniDatum + salt, encoding="UTF-8")).hexdigest()[5:13] == checksum:
        DS = crkeStevilke[DS[0]] + crkeStevilke[DS[1]] + DS[2:]
        rojstniDatum = rojstniDatum[0:2] + crkeStevilke[rojstniDatum[2]] + crkeStevilke[rojstniDatum[3]] + rojstniDatum[4:]
        if rojstniDatum != dob or int(DS) != taxno: return -1
        return (DS, rojstniDatum, datumPosiljanjaPlus1M)
    else: return -1

def verifyToken(token, salt, dob, taxno, dos):
    if decodeToken(token, salt, dob, taxno, dos) not in (-1, "Token length not 32."): return True
    else: return False

def verifyPovezava_soglasja(povezava_soglasja, token, pre, post):
    if povezava_soglasja == "{}{}{}".format(pre, token, post): return True
    else: return False

def verifyPravna_oseba(name_and_surname, pravna_oseba):
    title = name_and_surname.lower()
    if pravna_oseba:
        if "s.p." in title or "s. p." in title or "d.o.o." in title or "d. o. o." in title or "d.d." in title or "d. d." in title or "d.n.o." in title or "d. n. o." in title: return True
        else: return False
    else:
        if "s.p." in title or "s. p." in title or "d.o.o." in title or "d. o. o." in title or "d.d." in title or "d. d." in title or "d.n.o." in title or "d. n. o." in title: return False
        else: return True

def verifyPages(data):
    total = len(data)
    total_data = list()
    total_recipients = set()
    total_print = 0
    total_email = 0
    total_marketing = 0
    total_no_marketing = 0
    email_marketing = 0
    email_no_marketing = 0
    email_marketing_data = list()
    email_no_marketing_data = list()
    email_marketing_recipients = set()
    email_no_marketing_recipients = set()
    print_marketing = 0
    print_no_marketing = 0
    print_marketing_data = list()
    print_no_marketing_data = list()
    print_marketing_recipients = set()
    print_no_marketing_recipients = set()
    total_print_data = list()
    total_email_data = list()
    total_print_recipients = set()
    total_email_recipients = set()
    natural_print = 0
    natural_email = 0
    company_print = 0
    company_email = 0
    natural_print_data = list()
    natural_email_data = list()
    company_print_data = list()
    company_email_data = list()
    natural_print_recipients = set()
    natural_email_recipients = set()
    company_print_recipients = set()
    company_email_recipients = set()
    for datum in data:
        total_data.append(datum.getPolicy_no())
        total_recipients.add(datum.getCorr_id())
        if datum.getEposta():
            total_email_data.append(datum.getPolicy_no())
            total_email += 1
            total_email_recipients.add(datum.getCorr_id())
            if datum.getMarketing():
                total_marketing += 1
                email_marketing_data.append(datum.getPolicy_no())
                email_marketing += 1
                email_marketing_recipients.add(datum.getPolicy_no())
            else:
                total_no_marketing += 1
                email_no_marketing_data.append(datum.getPolicy_no())
                email_no_marketing += 1
                email_no_marketing_recipients.add(datum.getPolicy_no())
        else:
            total_print_data.append(datum.getPolicy_no())
            total_print += 1
            total_print_recipients.add(datum.getCorr_id())
            if datum.getMarketing():
                total_marketing += 1
                print_marketing_data.append(datum.getPolicy_no())
                print_marketing += 1
                print_marketing_recipients.add(datum.getPolicy_no())
            else:
                total_no_marketing += 1
                print_no_marketing_data.append(datum.getPolicy_no())
                print_no_marketing += 1
                print_no_marketing_recipients.add(datum.getPolicy_no())
        if datum.getEposta() and not datum.getPravna_oseba():
            natural_email_data.append(datum.getPolicy_no())
            natural_email += 1
            natural_email_recipients.add(datum.getCorr_id())
        elif datum.getEposta() and datum.getPravna_oseba():
            company_email_data.append(datum.getPolicy_no())
            company_email += 1
            company_email_recipients.add(datum.getCorr_id())
        elif not datum.getEposta() and not datum.getPravna_oseba():
            natural_print_data.append(datum.getPolicy_no())
            natural_print += 1
            natural_print_recipients.add(datum.getCorr_id())
        elif not datum.getEposta() and datum.getPravna_oseba():
            company_print_data.append(datum.getPolicy_no())
            company_print += 1
            company_print_recipients.add(datum.getCorr_id())
    fh = open("Izpiski_nalozbeniki_total.txt", "w")
    for policy in total_data: fh.write(policy + "\n")
    fh.close()
    fh = open("Izpiski_nalozbeniki_tisk.txt", "w")
    for policy in total_print_data: fh.write(policy + "\n")
    fh.close()
    fh = open("Izpiski_nalozbeniki_email.txt", "w")
    for policy in total_email_data: fh.write(policy + "\n")
    fh.close()
    fh = open("Izpiski_nalozbeniki_fizicne_tisk.txt", "w")
    for policy in natural_print_data: fh.write(policy + "\n")
    fh.close()
    fh = open("Izpiski_nalozbeniki_fizicne_email.txt", "w")
    for policy in natural_email_data: fh.write(policy + "\n")
    fh.close()
    fh = open("Izpiski_nalozbeniki_pravne_tisk.txt", "w")
    for policy in company_print_data: fh.write(policy + "\n")
    fh.close()
    fh = open("Izpiski_nalozbeniki_pravne_email.txt", "w")
    for policy in company_email_data: fh.write(policy + "\n")
    fh.close()
    fh = open("Izpiski_nalozbeniki_tisk_reklama.txt", "w")
    for policy in print_marketing_data: fh.write(policy + "\n")
    fh.close()
    fh = open("Izpiski_nalozbeniki_tisk_brez_reklame.txt", "w")
    for policy in print_no_marketing_data: fh.write(policy + "\n")
    fh.close()
    fh = open("Izpiski_nalozbeniki_email_reklama.txt", "w")
    for policy in email_marketing_data: fh.write(policy + "\n")
    fh.close()
    fh = open("Izpiski_nalozbeniki_email_brez_reklame.txt", "w")
    for policy in email_no_marketing_data: fh.write(policy + "\n")
    fh.close()
    return "\nTotal notifications: {}\nTotal recipients: {}\nTotal print: {}\nPrint recipients: {}\nTotal email: {}\nEmail recipients: {}\nNatural print: {}\nNatural print recipients: {}\nCompany print: {}\nCompany print recipients: {}\nNatural email: {}\nNatural email recipients: {}\nCompany email: {}\nCompany email recipients: {}\nTotal marketing: {}\nTotal marketing recipients: {}\nTotal no marketing: {}\nTotal no marketing recipients: {}\nPrint marketing: {}\nPrint marketing recipients: {}\nPrint no marketing: {}\nPrint no marketing recipients: {}\nEmail marketing: {}\nEmail_marketing_recipients: {}\nEmail no marketing: {}\nEmail no marketing recipients: {}\nPages print: {}\nPages email: {}\nIndividual policies saved in relevant files."\
        .format(total,
                len(total_recipients),
                total_print,
                len(total_print_recipients),
                total_email,
                len(total_email_recipients),
                natural_print,
                len(natural_print_recipients),
                company_print,
                len(company_print_recipients),
                natural_email,
                len(natural_email_recipients),
                company_email,
                len(company_email_recipients),
                total_marketing,
                len(email_marketing_recipients) + len(print_marketing_recipients),
                total_no_marketing,
                len(email_no_marketing_recipients) + len(print_no_marketing_recipients),
                print_marketing,
                len(print_marketing_recipients),
                print_no_marketing,
                len(print_no_marketing_recipients),
                email_marketing,
                len(email_marketing_recipients),
                email_no_marketing,
                len(email_no_marketing_recipients),
                len(natural_print_recipients) * 2 + natural_print * 2 + company_print * 2,
                total_email * 2)

def main():
    from time import time as t
    start = t()
    errors = 0
    c0 = 0
    corr_id = 0
    e_cnt = float("inf")
    e_rn = 0
    errors_c0 = list()
    errors_corr_id = list()
    errors_e_cnt = list()
    errors_e_rn = list()
    errors_letter_id = list()
    errors_letter_date = list()
    errors_white_text1 = list()
    errors_white_text2 = list()
    errors_white_text3 = list()
    errors_white_text4 = list()
    errors_white_text5 = list()
    errors_white_text6 = list()
    errors_barcode = list()
    errors_country = list()
    errors_data_date = list()
    errors_vp = list()
    errors_vp_2018_text = list()
    errors_free_text1 = list()
    errors_stipend_obroki = list()
    errors_text_stipendija = list()
    errors_eposta_naslov_za_posiljanje = list()
    errors_barcode_soglasje = list()
    errors_davcna_zavarovalec = list()
    errors_pozdrav_stranki = list()
    errors_izpis_noge = list()
    errors_benefit_table = list()
    errors_benefits = list()
    errors_benefit_desc = list()
    errors_text_kapitalizacija = list()
    errors_text_poslovalnica = list()
    errors_fund_table_nalozba = list()
    errors_fund_table_zajamceni = list()
    errors_funds = list()
    errors_fund_bonus = list()
    errors_free_text2 = list()
    errors_token_povezava_soglasja = list()
    errors_text_soglasje = list()
    errors_pravna_oseba = list()
    funds_policies = list()
    policies = getDataXLSX("Kontrola_nalozbeniki_2020.xlsx", "Kontrola_nalozbeniki_fund_2020.xlsx", "Kontrola_nalozbeniki_benefit_2020.xlsx", Policy, Fund, Benefit)
    for p in policies: print(p)
    quit()
  # policies = getDataXML("nalozbeniki.xml", Policy)
    for policy in policies:
        if policy.getC0() - c0 != 1:
            errors_c0.append(policy.getPolicy_no())
            print("c0 incorrect: {}".format(policy.getPolicy_no()))
            errors += 1
        c0 = policy.getC0()
        if policy.getE_cnt() > e_cnt:
            errors_e_cnt.append(policy.getPolicy_no())
            print("e_cnt incorrect: {}".format(policy.getPolicy_no()))
            errors += 1
        e_cnt = policy.getE_cnt()
        if policy.getCorr_id() - corr_id not in (0, 1) and policy.getCorr_id() < corr_id:
            errors_corr_id.append(policy.getPolicy_no())
            print("corr_id incorrect: {}".format(policy.getPolicy_no()))
            errors += 1
        if corr_id == policy.getCorr_id():
            if policy.getE_rn() - e_rn not in (0, 1):
                errors_e_rn.append(policy.getPolicy_no())
                print("e_rn incorrect: {}".format(policy.getPolicy_no()))
                errors += 1
            if policy.getE_rn() > policy.getE_cnt():
                errors_e_rn.append(policy.getPolicy_no())
                errors_e_cnt.append(policy.getPolicy_no())
                print("e_cnt/e_rn incorrect: {}".format(policy.getPolicy_no()))
                errors += 1
            e_rn = policy.getE_rn()
        else:
            corr_id = policy.getCorr_id()
            e_rn = 1
        if not verifyLetter_id(policy.getPolicy_no(), policy.getLetter_id(), 1, 3, 2019):
            errors_letter_id.append(policy.getPolicy_no())
            print("letter_id incorrect: {}".format(policy.getPolicy_no()))
            errors += 1
        if not verifyLetter_date(policy.getLetter_date(), "11. 3. 2019"):
            errors_letter_date.append(policy.getPolicy_no())
            print("letter_date incorrect: {}".format(policy.getPolicy_no()))
            errors += 1
        if not verifyWhite_text1(policy.getWhite_text1(), policy.getPolicy_no()):
            errors_white_text1.append(policy.getPolicy_no())
            print("white_text1 incorrect: {}".format(policy.getPolicy_no()))
            errors += 1
        if not verifyWhite_text2(policy.getWhite_text2(), policy.getLetter_id()):
            errors_white_text2.append(policy.getPolicy_no())
            print("white_text2 incorrect: {}".format(policy.getPolicy_no()))
            errors += 1
        if not verifyWhite_text3(policy.getWhite_text3(), policy.getLetter_date()):
            errors_white_text3.append(policy.getPolicy_no())
            print("white_text3 incorrect: {}".format(policy.getPolicy_no()))
            errors += 1
        if not verifyWhite_text4(policy.getWhite_text4(), "Letna obvestila"):
            errors_white_text4.append(policy.getPolicy_no())
            print("white_text4 incorrect: {}".format(policy.getPolicy_no()))
            errors += 1
        if not verifyWhite_text5(policy.getWhite_text5(), "Obvestilo o vrednosti naložbe ŽZ"):
            errors_white_text5.append(policy.getPolicy_no())
            print("white_text5 incorrect: {}".format(policy.getPolicy_no()))
            errors += 1
        if not verifyWhite_text6(policy.getWhite_text6(), policy.getProduct_desc()):
            errors_white_text6.append(policy.getPolicy_no())
            print("white_text6 incorrect: {}".format(policy.getPolicy_no()))
            errors += 1
        if not verifyBarcode(policy.getBarcode(), policy.getPolicy_no(), 502, 7):
            errors_barcode.append(policy.getPolicy_no())
            print("barcode incorrect: {}".format(policy.getPolicy_no()))
            errors += 1
        if not verifyCountry(policy.getCountry(), policy.getPost_no()):
            errors_country.append(policy.getPolicy_no())
            print("country incorrect: {}".format(policy.getPolicy_no()))
            errors += 1
        if not verifyData_date(policy.getData_date(), 2018):
            errors_data_date.append(policy.getPolicy_no())
            print("data_date incorrect: {}".format(policy.getPolicy_no()))
            errors += 1
        if not verifyVP(policy.getVp()):
            errors_vp.append(policy.getPolicy_no())
            print("vp incorrect: {}".format(policy.getPolicy_no()))
            errors += 1
        if not verifyVp_2018_text(policy.getVp_2018_text(), policy.getVp_2018()):
            errors_vp_2018_text.append(policy.getPolicy_no())
            print("vp_2018_text incorrect: {}".format(policy.getPolicy_no()))
            errors += 1
        if not verifyFree_text1(policy.getFree_text1(), policy.getPlanno(), policy.getDob_zavarovalec()[-4:], ("1988", "1974", "1964", "1956")):
            errors_free_text1.append(policy.getPolicy_no())
            print("free_text1 incorrect: {}".format(policy.getPolicy_no()))
            errors += 1
        if not verifyStipend_obroki(policy.getStipend_obroki(), policy.getPol_stat()):
            errors_stipend_obroki.append(policy.getPolicy_no())
            print("stipend_obroki incorrect: {}".format(policy.getPolicy_no()))
            errors += 1
        if not verifyText_stipendija(policy.getText_stipendija(), policy.getStipend_obroki(), policy.getPol_stat()):
            errors_text_stipendija.append(policy.getPolicy_no())
            print("text_stipendija incorrect: {}".format(policy.getPolicy_no()))
            errors += 1
        if not verifyBarcode_soglasje(policy.getBarcode_soglasje(), policy.getOseba_id(), policy.getEposta(), policy.getPravna_oseba(), 505, 1):
            errors_barcode_soglasje.append(policy.getPolicy_no())
            print("barcode_soglasje incorrect: {}".format(policy.getPolicy_no()))
            errors += 1
        if not verifyDavcna_zavarovalec(policy.getDavcna_zavarovalec()):
            errors_davcna_zavarovalec.append((policy.getPolicy_no(), policy.getDavcna_zavarovalec()))
            print("davcna_zavarovalec incorrect: {} {}".format(policy.getPolicy_no(), policy.getDavcna_zavarovalec()))
            errors += 1
        if not verifyPozdrav_stranki(policy.getPozdrav_stranki(), policy.getPravna_oseba(), policy.getIme_zavarovalec(), policy.getPriimek_zavarovalec()):
            errors_pozdrav_stranki.append(policy.getPolicy_no())
            print("pozdrav_stranki incorrect: {}".format(policy.getPolicy_no()))
            errors += 1
        if not verifyIzpis_noge(policy.getIzpis_noge(), policy.getMarketing()):
            errors_izpis_noge.append(policy.getPolicy_no())
            print("izpis_noge incorrect: {}".format(policy.getPolicy_no()))
            errors += 1
        if not verifyBenefit_table(policy.getBenefit_table(), policy.getPol_stat()):
            errors_benefit_table.append(policy.getPolicy_no())
            print("benefit_table incorrect: {}".format(policy.getPolicy_no()))
            errors += 1
        if not verifyBenefits(policy.getBenefit_table(), policy.getBenefits()):
            errors_benefits.append(policy.getPolicy_no())
            print("benefits incorrect: {}".format(policy.getPolicy_no()))
            errors += 1
        for benefit in policy.getBenefits():
            if not verifyBenefit_desc(benefit.getBenefit_desc()):
                errors_benefit_desc.append((policy.getPolicy_no(), benefit.getBenefit_desc()))
                print("benefit_desc incorrect: {} {}".format(policy.getPolicy_no(), benefit.getBenefit_desc()))
                errors += 1
        if not verifyText_kapitalizacija(policy.getText_kapitalizacija(), policy.getPol_stat()):
            errors_text_kapitalizacija.append(policy.getPolicy_no())
            print("text_kapitalizacija incorrect: {}".format(policy.getPolicy_no()))
            errors += 1
        if not verifyText_poslovalnica(policy.getText_poslovalnica(), policy.getPravna_oseba()):
            errors_text_poslovalnica.append(policy.getPolicy_no())
            print("text_poslovalnica incorrect: {}".format(policy.getPolicy_no()))
            errors += 1
        if not verifyFund_table_nalozba(policy.getFund_table_nalozba(), policy.getPlanno()):
            errors_fund_table_nalozba.append(policy.getPolicy_no())
            print("fund_table_nalozba incorrect: {}".format(policy.getPolicy_no()))
            errors += 1
        if not verifyFund_table_zajamceni(policy.getFund_table_zajamceni(), policy.getPlanno()):
            errors_fund_table_zajamceni.append(policy.getPolicy_no())
            print("fund_table_zajamceni incorrect: {}".format(policy.getPolicy_no()))
            errors += 1
        if not verifyFunds(policy.getFund_table_nalozba(), policy.getFund_table_zajamceni(), policy.getFunds()):
            errors_funds.append(policy.getPolicy_no())
            print("funds incorrect: {}".format(policy.getPolicy_no()))
            errors += 1
        if not verifyFund_bonus(policy.getProduct_desc(), policy.getFunds(), policy.getPolicy_no()):
            errors_fund_bonus.append(policy.getPolicy_no())
            print("fund_bonus incorrect: {}".format(policy.getPolicy_no()))
            errors += 1
        if not verifyFree_text2(policy.getFree_text2(), policy.getFunds()):
            errors_free_text2.append(policy.getPolicy_no())
            print("free_text2 incorrect: {}".format(policy.getPolicy_no()))
            errors += 1
        if policy.getEposta():
            if not verifyEposta_naslov_za_posiljanje(policy.getEposta_naslov_za_posiljanje()):
                errors_eposta_naslov_za_posiljanje.append((policy.getPolicy_no(), policy.getEposta_naslov_za_posiljanje()))
                print("eposta_naslov_za_posiljanje incorrect: {} {}".format(policy.getPolicy_no(), policy.getEposta_naslov_za_posiljanje()))
                errors += 1
            if not policy.getPravna_oseba():
                if not verifyToken(policy.getToken(), "izpiski", convertDateYYYYMMDD(policy.getDob_zavarovalec()), policy.getDavcna_zavarovalec(), "20190411"):
                    errors_token_povezava_soglasja.append(policy.getPolicy_no())
                    print("token incorrect: {}".format(policy.getPolicy_no()))
                    errors += 1
                if not verifyPovezava_soglasja(policy.getPovezava_soglasja(), policy.getToken(), "https://www.nlbvita.si/gdpr?token=", "&utm_source=credo_email&utm_medium=email&utm_campaign=zivljenjsko_obvestilo"):
                    errors_token_povezava_soglasja.append(policy.getPolicy_no())
                    print("povezava_soglasja incorrect: {}".format(policy.getPolicy_no()))
                    errors += 1
            else:
                if policy.getToken() or policy.getPovezava_soglasja():
                    errors_token_povezava_soglasja.append(policy.getPolicy_no())
                    print("token/povezava_soglasja incorrect: {}".format(policy.getPolicy_no()))
                    errors += 1
        else:
            if not verifyText_soglasje(policy.getText_soglasje(), policy.getPravna_oseba()):
                errors_text_soglasje.append(policy.getPolicy_no())
                print("text_soglasje incorrect: {}".format(policy.getPolicy_no()))
                errors += 1
            if policy.getToken() or policy.getPovezava_soglasja():
                errors_token_povezava_soglasja.append(policy.getPolicy_no())
                print("token/povezava_soglasja incorrect: {}".format(policy.getPolicy_no()))
                errors += 1
        if not verifyPravna_oseba(policy.getName_and_surname(), policy.getPravna_oseba()):
            errors_pravna_oseba.append(policy.getPolicy_no())
            print("pravna_oseba incorrect: {}".format(policy.getPolicy_no()))
            errors += 1
        funds_policies.append((len(policy.getFunds()), policy.getPolicy_no(), "email" if policy.getEposta() else "tisk", policy.getCorr_id()))
    funds_policies.sort(reverse=True)
    print(verifyPages(policies))
    if errors:
        fh = open("errorsNalozbenikiXML.txt", "w")
        if errors_c0:
            fh.write("c0 errors:\n")
            for e in errors_c0: fh.write(e + "\n")
            fh.write("\n")
        if errors_corr_id:
            fh.write("corr_id errors:\n")
            for e in errors_corr_id: fh.write(e + "\n")
            fh.write("\n")
        if errors_e_cnt:
            fh.write("e_cnt errors:\n")
            for e in errors_e_cnt: fh.write(e + "\n")
            fh.write("\n")
        if errors_e_rn:
            fh.write("e_rn errors:\n")
            for e in errors_e_rn: fh.write(e + "\n")
            fh.write("\n")
        if errors_letter_id:
            fh.write("letter_id errors:\n")
            for e in errors_letter_id: fh.write(e + "\n")
            fh.write("\n")
        if errors_letter_date:
            fh.write("letter_date errors:\n")
            for e in errors_letter_date: fh.write(e + "\n")
            fh.write("\n")
        if errors_white_text1:
            fh.write("white_text1 errors:\n")
            for e in errors_white_text1: fh.write(e + "\n")
            fh.write("\n")
        if errors_white_text2:
            fh.write("white_text2 errors:\n")
            for e in errors_white_text2: fh.write(e + "\n")
            fh.write("\n")
        if errors_white_text3:
            fh.write("white_text3 errors:\n")
            for e in errors_white_text3: fh.write(e + "\n")
            fh.write("\n")
        if errors_white_text4:
            fh.write("white_text4 errors:\n")
            for e in errors_white_text4: fh.write(e + "\n")
            fh.write("\n")
        if errors_white_text5:
            fh.write("white_text5 errors:\n")
            for e in errors_white_text5: fh.write(e + "\n")
            fh.write("\n")
        if errors_white_text6:
            fh.write("white_text6 errors:\n")
            for e in errors_white_text6: fh.write(e + "\n")
            fh.write("\n")
        if errors_barcode:
            fh.write("barcode errors:\n")
            for e in errors_barcode: fh.write(e + "\n")
            fh.write("\n")
        if errors_country:
            fh.write("country errors:\n")
            for e in errors_country: fh.write(e + "\n")
            fh.write("\n")
        if errors_data_date:
            fh.write("data_date errors:\n")
            for e in errors_data_date: fh.write(e + "\n")
            fh.write("\n")
        if errors_vp:
            fh.write("vp errors:\n")
            for e in errors_vp: fh.write(e + "\n")
            fh.write("\n")
        if errors_vp_2018_text:
            fh.write("vp_2018_text errors:\n")
            for e in errors_vp_2018_text: fh.write(e + "\n")
            fh.write("\n")
        if errors_free_text1:
            fh.write("free_text1 errors:\n")
            for e in errors_free_text1: fh.write(e + "\n")
            fh.write("\n")
        if errors_stipend_obroki:
            fh.write("stipend_obroki errors:\n")
            for e in errors_stipend_obroki: fh.write(e + "\n")
            fh.write("\n")
        if errors_text_stipendija:
            fh.write("text_stipendija errors:\n")
            for e in errors_text_stipendija: fh.write(e + "\n")
            fh.write("\n")
        if errors_eposta_naslov_za_posiljanje:
            fh.write("eposta_naslov_za_posiljanje errors:\n")
            for e in errors_eposta_naslov_za_posiljanje: fh.write("{} {}".format(e[0], e[1]) + "\n")
            fh.write("\n")
        if errors_barcode_soglasje:
            fh.write("barcode_soglasje errors:\n")
            for e in errors_barcode_soglasje: fh.write(e + "\n")
            fh.write("\n")
        if errors_davcna_zavarovalec:
            fh.write("davcna_zavarovalec errors:\n")
            for e in errors_davcna_zavarovalec: fh.write("{} {}".format(e[0], e[1]) + "\n")
            fh.write("\n")
        if errors_pozdrav_stranki:
            fh.write("pozdrav_stranki errors:\n")
            for e in errors_pozdrav_stranki: fh.write(e + "\n")
            fh.write("\n")
        if errors_izpis_noge:
            fh.write("izpis_noge errors:\n")
            for e in errors_izpis_noge: fh.write(e + "\n")
            fh.write("\n")
        if errors_benefit_table:
            fh.write("benefit_table errors:\n")
            for e in errors_benefit_table: fh.write(e + "\n")
            fh.write("\n")
        if errors_benefits:
            fh.write("benefits errors:\n")
            for e in errors_benefits: fh.write(e + "\n")
            fh.write("\n")
        if errors_benefit_desc:
            fh.write("benefit_desc errors:\n")
            for e in errors_benefit_desc: fh.write("{} {}".format(e[0], e[1]) + "\n")
            fh.write("\n")
        if errors_text_kapitalizacija:
            fh.write("text_kapitalizacija errors:\n")
            for e in errors_text_kapitalizacija: fh.write(e + "\n")
            fh.write("\n")
        if errors_text_poslovalnica:
            fh.write("text_poslovalnica errors:\n")
            for e in errors_text_poslovalnica: fh.write(e + "\n")
            fh.write("\n")
        if errors_fund_table_nalozba:
            fh.write("fund_table_nalozba errors:\n")
            for e in errors_fund_table_nalozba: fh.write(e + "\n")
            fh.write("\n")
        if errors_fund_table_zajamceni:
            fh.write("fund_table_zajamceni errors:\n")
            for e in errors_fund_table_zajamceni: fh.write(e + "\n")
            fh.write("\n")
        if errors_funds:
            fh.write("funds errors:\n")
            for e in errors_funds: fh.write(e + "\n")
            fh.write("\n")
        if errors_fund_bonus:
            fh.write("fund_bonus errors:\n")
            for e in errors_fund_bonus: fh.write(e + "\n")
            fh.write("\n")
        if errors_free_text2:
            fh.write("free_text2 errors:\n")
            for e in errors_free_text2: fh.write(e + "\n")
            fh.write("\n")
        if errors_token_povezava_soglasja:
            fh.write("token/povezava_soglasja errors:\n")
            for e in errors_token_povezava_soglasja: fh.write(e + "\n")
            fh.write("\n")
        if errors_text_soglasje:
            fh.write("text_soglasje errors:\n")
            for e in errors_text_soglasje: fh.write(e + "\n")
            fh.write("\n")
        if errors_pravna_oseba:
            fh.write("pravna_oseba errors:\n")
            for e in errors_pravna_oseba: fh.write(e + "\n")
        fh.close()
        print("\n{} errors found. Errors saved to file errorsNalozbenikiXML.txt".format(errors))
    else: print("\nNo errors found.")
    fh = open("funds_policies.txt", "w")
    for fp in funds_policies: fh.write("{:>2} {} {:>5} {:>5}\n".format(fp[0], fp[1], fp[2], fp[3]))
    fh.close()
    print("\nNumber of funds and corresponding policy numbers saved to file funds_policies.txt.")
    print("\nFinished in %s seconds." % "{0:.3f}".format(t() - start))

if __name__ == "__main__":
    main()